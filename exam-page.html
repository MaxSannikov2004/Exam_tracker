<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exam Tracker ‚Äî —Ç–∞–π–º–µ—Ä</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  
<script>
  (function(){
    const t = localStorage.getItem("examTracker.theme") || "light";
    document.documentElement.dataset.theme = t;
  })();
</script>
<style>
    :root{
  --bg: #0b1020;
  --overlay: rgba(11,16,32,.78);

  --card: rgba(255,255,255,.10);
  --line: rgba(255,255,255,.18);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.70);

  --shadow: 0 12px 30px rgba(0,0,0,.35);
  --r: 18px;
  --accent: #7aa2ff;
  --accent2:#ff8a3d;

  /* –ü–ª–∞—à–∫–∞ "—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è" */
  --nowBg: rgba(255,255,255,.92);
  --nowBorder: rgba(17,24,39,.18);
  --nowText: #0b1020;
  --nowLabel: rgba(17,24,39,.65);

  /* –ö–∞—Ä—Ç–æ—á–∫–∞-—Ç–∞–π–º–µ—Ä (—Ç–∞–±–ª–∏—Ü–∞) */
  --timerBg: rgba(17,24,39,.60);
  --timerBorder: rgba(255,255,255,.18);
  --timerBorder2: rgba(255,255,255,.12);
  --timerText: rgba(255,255,255,.92);
  --timerMuted: rgba(255,255,255,.70);
  --timerThBg: rgba(255,255,255,.06);
  --timerThText: rgba(255,255,255,.86);
  --timerBarBg: rgba(255,255,255,.10);
  --timerBarBorder: rgba(255,255,255,.16);

  --rowOk: rgba(122,162,255,.07);
  --rowWarn: rgba(255,138,61,.20);
  --rowDanger: rgba(255,84,84,.22);
  --rowDone: rgba(255,255,255,.06);

  /* –ö–Ω–æ–ø–∫–∏ "ghost" */
  --ghostBg: rgba(255,255,255,.10);
  --ghostBorder: rgba(255,255,255,.18);
}

html[data-theme="light"]{
  --bg: #f5f7ff;
  --overlay: rgba(245,247,255,.86);

  --card: rgba(255,255,255,.92);
  --line: rgba(17,24,39,.14);
  --text: rgba(17,24,39,.92);
  --muted: rgba(17,24,39,.62);
  --shadow: 0 10px 24px rgba(0,0,0,.12);

  --nowBg: rgba(255,255,255,.92);
  --nowBorder: rgba(17,24,39,.14);
  --nowText: rgba(17,24,39,.92);
  --nowLabel: rgba(17,24,39,.60);

  --timerBg: rgba(255,255,255,.92);
  --timerBorder: rgba(17,24,39,.14);
  --timerBorder2: rgba(17,24,39,.10);
  --timerText: rgba(17,24,39,.92);
  --timerMuted: rgba(17,24,39,.62);
  --timerThBg: rgba(17,24,39,.04);
  --timerThText: rgba(17,24,39,.86);
  --timerBarBg: rgba(17,24,39,.06);
  --timerBarBorder: rgba(17,24,39,.12);

  --rowOk: rgba(255,255,255,1);
  --rowWarn: rgba(255,247,237,1);
  --rowDanger: rgba(254,226,226,1);
  --rowDone: rgba(243,244,246,1);

  --ghostBg: rgba(255,255,255,.82);
  --ghostBorder: rgba(17,24,39,.14);
}

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Roboto, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      color: var(--text);
      min-height:100vh;
      background-color: var(--bg);
      background-image:
        linear-gradient(180deg, var(--overlay), var(--overlay)),
        url("image/image.png");
      background-size: cover;
      background-position: top center;
      background-repeat:no-repeat;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 16px 40px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .left{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .title{
      font-size: 22px;
      font-weight: 800;
      margin: 0;
    }

    .meta{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.3;
    }

    .now{
  display:flex;
  align-items:baseline;
  gap: 10px;
  padding: 14px 16px;
  border-radius: 999px;
  border: 1px solid var(--nowBorder);
  background: var(--nowBg);
  box-shadow: var(--shadow);
  color: var(--nowText);
}
.now .label{ color: var(--nowLabel); font-size: 12px; }
.now .time{ font-size: clamp(40px, 6vw, 64px); font-weight: 900; letter-spacing: .5px; line-height: 1; }


    .card{
      background: var(--card);
      border: 1px solid var(--ghostBorder);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .card.timer{
  background: var(--timerBg);
  border: 1px solid var(--timerBorder);
  color: var(--timerText);
}
.card.timer th{
  background: var(--timerThBg);
  color: var(--timerThText);
  border-bottom: 1px solid var(--timerBorder2);
}
.card.timer td{
  border-bottom: 1px solid var(--timerBorder2);
  color: var(--timerText);
}
.card.timer .sub{ color: var(--timerMuted); }
.card.timer .bar{
  background: var(--timerBarBg);
  border: 1px solid var(--timerBarBorder);
}


    .sub{
      font-size: 12px;
      margin-top: 4px;
      opacity: .72;
    }

    .tableWrap{
      overflow-x: auto;
    }

    table{
      width: 100%;
      border-collapse: collapse;
      min-width: 860px;
    }

    th, td{
      padding: 12px 12px;
      border-bottom: 1px solid var(--timerBorder2);
      text-align: left;
      vertical-align: middle;
      white-space: nowrap;
    }

    th{
      font-size: 12px;
      letter-spacing: .25px;
      text-transform: uppercase;
      color: var(--timerThText);
      background: var(--timerThBg);
    }

    tr.ok{ background: var(--rowOk); }
    tr.warn{ background: var(--rowWarn); }
    tr.danger{ background: var(--rowDanger); }
    tr.done{ background: var(--rowDone); }

    .bar{
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: var(--timerBarBg);
      border: 1px solid var(--timerBarBorder);
      overflow:hidden;
    }
    .fill{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width .5s ease;
    }

    .actions{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button{
      border: 0;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
      color: #0b1020;
      background: linear-gradient(135deg, var(--accent), #b2c7ff);
    }
    .ghost{
      color: var(--text);
      background: var(--ghostBg);
      border: 1px solid var(--ghostBorder);
    }

    .small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
      line-height: 1.35;
    }
  
.right{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap: 10px;
  flex-wrap: wrap;
}

.themeBtn{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  border-radius: 999px;
  padding: 10px 12px;
  border: 1px solid var(--ghostBorder);
  background: var(--ghostBg);
  color: var(--text);
  font-weight: 800;
  cursor: pointer;
  user-select: none;
}

  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="left">
        <div class="title">–¢–∞–π–º–µ—Ä —ç–∫–∑–∞–º–µ–Ω–æ–≤</div>
        <div class="meta" id="metaLine">‚Äî</div>
      </div>

      <div class="right">
        <button class="themeBtn" id="themeBtn" type="button" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">‚Äî</button>
        <div class="now">
          <div class="label">–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (–ú–°–ö / –°–∞–Ω–∫—Ç‚Äë–ü–µ—Ç–µ—Ä–±—É—Ä–≥)</div>
          <div class="time" id="currentTime">--:--</div>
        </div>
      </div>
    </header>

    <section class="card timer">
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>–≠–∫–∑–∞–º–µ–Ω</th>
              <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
              <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
              <th>–û—Å—Ç–∞–ª–æ—Å—å</th>
              <th style="min-width: 220px;">–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </section>

    <div class="actions">
      <button type="button" class="ghost" id="backBtn">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É</button>
      <button type="button" class="ghost" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</button>
    </div>

    <div class="small">
      –ü–æ–¥—Å–≤–µ—Ç–∫–∞: <b>‚â§30 –º–∏–Ω</b> ‚Äî –æ—Ä–∞–Ω–∂–µ–≤–∞—è, <b>‚â§5 –º–∏–Ω</b> ‚Äî –∫—Ä–∞—Å–Ω–∞—è, <b>‚â§0</b> ‚Äî ‚Äú–æ–∫–æ–Ω—á–µ–Ω‚Äù.
      –í—Ä–µ–º—è —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –ú–°–ö (–°–∞–Ω–∫—Ç‚Äë–ü–µ—Ç–µ—Ä–±—É—Ä–≥).
    </div>
  </div>

<script>
  const STORAGE_KEY = "examTracker.v2";

const THEME_KEY = "examTracker.theme";
const themeBtn = document.getElementById("themeBtn");

function getTheme(){
  return localStorage.getItem(THEME_KEY) || "light";
}
function setTheme(t){
  document.documentElement.dataset.theme = t;
  localStorage.setItem(THEME_KEY, t);
  updateThemeBtn();
}
function updateThemeBtn(){
  const t = getTheme();
  themeBtn.innerHTML = (t === "dark")
    ? 'üåô –¢—ë–º–Ω–∞—è'
    : '‚òÄ –°–≤–µ—Ç–ª–∞—è';
}
themeBtn.addEventListener("click", () => {
  setTheme(getTheme() === "dark" ? "light" : "dark");
});
updateThemeBtn();


  // –¢–∞ –∂–µ —Ç–∞–±–ª–∏—Ü–∞ —ç–∫–∑–∞–º–µ–Ω–æ–≤, —á—Ç–æ –∏ –Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
  const EXAMS = [
    { id: "ege_russian", type: "–ï–ì–≠", subject: "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", durationMin: 210 },
    { id: "ege_math_base", type: "–ï–ì–≠", subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (–±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å)", durationMin: 180 },
    { id: "ege_math_profile", type: "–ï–ì–≠", subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (–ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)", durationMin: 235 },

    { id: "ege_physics", type: "–ï–ì–≠", subject: "–§–∏–∑–∏–∫–∞", durationMin: 235 },
    { id: "ege_chemistry", type: "–ï–ì–≠", subject: "–•–∏–º–∏—è", durationMin: 210 },
    { id: "ege_biology", type: "–ï–ì–≠", subject: "–ë–∏–æ–ª–æ–≥–∏—è", durationMin: 235 },
    { id: "ege_informatics", type: "–ï–ì–≠", subject: "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ (–ö–ï–ì–≠)", durationMin: 235 },
    { id: "ege_geography", type: "–ï–ì–≠", subject: "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è", durationMin: 180 },

    { id: "ege_social", type: "–ï–ì–≠", subject: "–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", durationMin: 210 },
    { id: "ege_history", type: "–ï–ì–≠", subject: "–ò—Å—Ç–æ—Ä–∏—è", durationMin: 210 },
    { id: "ege_literature", type: "–ï–ì–≠", subject: "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", durationMin: 235 },

    { id: "ege_en_written", type: "–ï–ì–≠", subject: "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Äî –ø–∏—Å—å–º–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 190 },
    { id: "ege_en_oral", type: "–ï–ì–≠", subject: "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Äî —É—Å—Ç–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 17 },

    { id: "ege_de_written", type: "–ï–ì–≠", subject: "–ù–µ–º–µ—Ü–∫–∏–π ‚Äî –ø–∏—Å—å–º–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 190 },
    { id: "ege_de_oral", type: "–ï–ì–≠", subject: "–ù–µ–º–µ—Ü–∫–∏–π ‚Äî —É—Å—Ç–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 17 },

    { id: "ege_fr_written", type: "–ï–ì–≠", subject: "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π ‚Äî –ø–∏—Å—å–º–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 190 },
    { id: "ege_fr_oral", type: "–ï–ì–≠", subject: "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π ‚Äî —É—Å—Ç–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 17 },

    { id: "ege_es_written", type: "–ï–ì–≠", subject: "–ò—Å–ø–∞–Ω—Å–∫–∏–π ‚Äî –ø–∏—Å—å–º–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 190 },
    { id: "ege_es_oral", type: "–ï–ì–≠", subject: "–ò—Å–ø–∞–Ω—Å–∫–∏–π ‚Äî —É—Å—Ç–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 17 },

    { id: "ege_zh_written", type: "–ï–ì–≠", subject: "–ö–∏—Ç–∞–π—Å–∫–∏–π ‚Äî –ø–∏—Å—å–º–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 180 },
    { id: "ege_zh_oral", type: "–ï–ì–≠", subject: "–ö–∏—Ç–∞–π—Å–∫–∏–π ‚Äî —É—Å—Ç–Ω–∞—è —á–∞—Å—Ç—å", durationMin: 14 },
  ];

  const examById = new Map(EXAMS.map(e => [e.id, e]));

  function formatDuration(min){
    const h = Math.floor(min / 60);
    const m = min % 60;
    const parts = [];
    if (h) parts.push(`${h} —á`);
    if (m) parts.push(`${m} –º–∏–Ω`);
    return parts.join(" ");
  }

  function pad2(n){ return String(n).padStart(2, "0"); }

  function formatCountdown(ms){
    const total = Math.max(0, Math.ceil(ms / 1000));
    const h = Math.floor(total / 3600);
    const m = Math.floor((total % 3600) / 60);
    const s = total % 60;
    return h > 0 ? `${h}:${pad2(m)}:${pad2(s)}` : `${m}:${pad2(s)}`;
  }

  function getParts(date, timeZone){
    const dtf = new Intl.DateTimeFormat("en-US", {
      timeZone,
      year: "numeric", month: "2-digit", day: "2-digit",
      hour: "2-digit", minute: "2-digit", second: "2-digit",
      hour12: false
    });
    const parts = dtf.formatToParts(date);
    const map = {};
    for (const p of parts) if (p.type !== "literal") map[p.type] = p.value;
    return {
      year: +map.year, month: +map.month, day: +map.day,
      hour: +map.hour, minute: +map.minute, second: +map.second
    };
  }

  function tzOffsetMinutes(timeZone, date){
    const p = getParts(date, timeZone);
    const asUTC = Date.UTC(p.year, p.month - 1, p.day, p.hour, p.minute, p.second);
    return (asUTC - date.getTime()) / 60000;
  }

  // –î–µ–ª–∞–µ—Ç Date, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç "—Å—Ç–µ–Ω–æ—á–Ω–æ–º—É" –≤—Ä–µ–º–µ–Ω–∏ –≤ timeZone (–≤–∞–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –≤ –ú–°–ö, –¥–∞–∂–µ –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –≤ –ú–°–ö)
  function makeZonedDate({year, month, day, hour, minute, second}, timeZone){
    const utcGuess = new Date(Date.UTC(year, month - 1, day, hour, minute, second || 0));
    const off = tzOffsetMinutes(timeZone, utcGuess);
    return new Date(utcGuess.getTime() - off * 60000);
  }

  function formatTime(date, timeZone){
    return new Intl.DateTimeFormat("ru-RU", {
      timeZone,
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    }).format(date);
  }

  function loadState(){
    try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || null; }
    catch(e){ return null; }
  }

  function init(){
    const state = loadState();
    if (!state?.startTime || !Array.isArray(state.selectedExamIds) || state.selectedExamIds.length === 0){
      alert("–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–∫–∑–∞–º–µ–Ω–æ–≤. –í–µ—Ä–Ω—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±–æ—Ä–∞.");
      window.location.href = "index.html";
      return;
    }

        const tz = "Europe/Moscow";
    const tzLabel = "–ú–°–ö (–°–∞–Ω–∫—Ç‚Äë–ü–µ—Ç–µ—Ä–±—É—Ä–≥)";

    const now = new Date();
    const nowP = getParts(now, tz);

    const [sh, sm] = state.startTime.split(":").map(Number);
    const startDate = makeZonedDate({year: nowP.year, month: nowP.month, day: nowP.day, hour: sh, minute: sm, second: 0}, tz);

    document.getElementById("metaLine").textContent =
      `–°—Ç–∞—Ä—Ç: ${state.startTime} ¬∑ –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${tzLabel} ¬∑ –≠–∫–∑–∞–º–µ–Ω–æ–≤: ${state.selectedExamIds.length}`;

    const rowsEl = document.getElementById("rows");
    rowsEl.innerHTML = "";

    // –ø–æ—Å—Ç—Ä–æ–∏–º —Å—Ç—Ä–æ–∫–∏
    const items = state.selectedExamIds
      .map(id => examById.get(id))
      .filter(Boolean)
      .map(ex => {
        const end = new Date(startDate.getTime() + ex.durationMin * 60000);
        return { ex, endMs: end.getTime(), startMs: startDate.getTime(), end };
      })
      .sort((a,b) => a.endMs - b.endMs);

    for (const it of items){
      const tr = document.createElement("tr");
      tr.className = "ok";
      tr.dataset.endMs = String(it.endMs);
      tr.dataset.startMs = String(it.startMs);

      tr.innerHTML = `
        <td><b>${it.ex.subject}</b><div class="sub">${it.ex.type}</div></td>
        <td>${formatDuration(it.ex.durationMin)}</td>
        <td class="endAt">${formatTime(it.end, tz)}</td>
        <td class="left">--:--</td>
        <td>
          <div class="bar"><div class="fill"></div></div>
        </td>
      `;
      rowsEl.appendChild(tr);
    }

    function tick(){
      const now = new Date();
      document.getElementById("currentTime").textContent = formatTime(now, tz);

      const nowMs = now.getTime();
      const trs = rowsEl.querySelectorAll("tr");

      trs.forEach(tr => {
        const endMs = +tr.dataset.endMs;
        const startMs = +tr.dataset.startMs;

        const leftMs = endMs - nowMs;
        const leftCell = tr.querySelector(".left");
        const fill = tr.querySelector(".fill");

        const total = Math.max(1, endMs - startMs);
        const passed = Math.min(total, Math.max(0, nowMs - startMs));
        const pct = (passed / total) * 100;
        fill.style.width = `${pct.toFixed(1)}%`;

        tr.classList.remove("ok","warn","danger","done");

        if (leftMs <= 0){
          tr.classList.add("done");
          leftCell.textContent = "–û–∫–æ–Ω—á–µ–Ω";
          fill.style.width = "100%";
        } else {
          leftCell.textContent = formatCountdown(leftMs);
          const leftMin = leftMs / 60000;
          if (leftMin <= 5) tr.classList.add("danger");
          else if (leftMin <= 30) tr.classList.add("warn");
          else tr.classList.add("ok");
        }
      });
    }

    tick();
    setInterval(tick, 1000);

    document.getElementById("backBtn").addEventListener("click", () => {
      window.location.href = "index.html";
    });

    document.getElementById("resetBtn").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEY);
      window.location.href = "index.html";
    });
  }

  window.addEventListener("load", init);
</script>
</body>
</html>
